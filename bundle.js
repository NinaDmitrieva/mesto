(()=>{"use strict";function e(e,t){for(var n=0;n<t.length;n++){var o=t[n];o.enumerable=o.enumerable||!1,o.configurable=!0,"value"in o&&(o.writable=!0),Object.defineProperty(e,o.key,o)}}var t=function(){function t(e,n){!function(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}(this,t),this._name=e.name,this._link=e.link,this._id=e._id,this._userId=e.userId,this.ownerId=e.ownerId,this.likes=e.likes,this._handleCardClick=e.handleCardClick,this._handleDeleteClick=e.handleDeleteClick,this.handleLikeClick=e.handleLikeClick,this.handleRemoveLike=e.handleRemoveLike,this._templateSelector=n,this.setLikes=this.setLikes.bind(this)}var n,o;return n=t,(o=[{key:"_getTemplate",value:function(){return document.querySelector(this._templateSelector).content.querySelector(".element").cloneNode(!0)}},{key:"removeCard",value:function(){this.element.remove(),this.element=null}},{key:"generateCard",value:function(){return this.element=this._getTemplate(),this.btnLike=this.element.querySelector(".element__click"),this.btnClose=this.element.querySelector(".element__close-icon"),this.likeСontainer=this.element.querySelector(".element__span-like"),this.cardImage=this.element.querySelector(".element__foto"),this.cardName=this.element.querySelector(".element__title"),this.cardImage.src=this._link,this.cardImage.alt=this._name,this.cardName.textContent=this._name,this.renderLikeBtn(),this.renderLikeCounter(),this.renderDeleteBtn(),this._setEventListeners(),this.element}},{key:"_checkId",value:function(e){return this.likes.some((function(t){return e===t._id}))}},{key:"_setEventListeners",value:function(){var e=this;this.btnLike.addEventListener("click",(function(){e.toggleLike()})),this.btnClose.addEventListener("click",(function(){e._handleDeleteClick(e)})),this.cardImage.addEventListener("click",(function(){e._handleCardClick(e._name,e._link)}))}},{key:"renderDeleteBtn",value:function(){this.ownerId!==this._userId&&this.btnClose.remove()}},{key:"renderLikeBtn",value:function(){this._checkId(this._userId)?this.btnLike.classList.add("element__like_activ"):this.btnLike.classList.remove("element__like_activ")}},{key:"setLikes",value:function(e){this.likes=e,this.renderLikeCounter(),this.renderLikeBtn()}},{key:"renderLikeCounter",value:function(){this.likeСontainer.textContent=this.likes.length}},{key:"toggleLike",value:function(){this._checkId(this._userId)?this.handleRemoveLike(this._id,this.setLikes):this.handleLikeClick(this._id,this.setLikes)}}])&&e(n.prototype,o),Object.defineProperty(n,"prototype",{writable:!1}),t}();function n(e,t){for(var n=0;n<t.length;n++){var o=t[n];o.enumerable=o.enumerable||!1,o.configurable=!0,"value"in o&&(o.writable=!0),Object.defineProperty(e,o.key,o)}}var o=function(){function e(t,n){!function(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}(this,e),this._form=n,this._inputSelector=t.inputSelector,this._inputErrorClass=t.inputErrorClass,this._submitButtonSelector=t.submitButtonSelector,this._submitButtonErrorClass=t.submitButtonErrorClass,this._inputs=Array.from(this._form.querySelectorAll(this._inputSelector)),this._button=n.querySelector(this._submitButtonSelector)}var t,o;return t=e,(o=[{key:"enableValidation",value:function(){this._setEventListeners(this._form)}},{key:"_setEventListeners",value:function(e){var t=this;this._inputs.forEach((function(n){return n.addEventListener("input",(function(){t._handleField(e,n),t.setSubmitButtonState(e)}))}))}},{key:"_handleField",value:function(e,t){t.validity.valid?this._hideError(e,t):this._showError(e,t)}},{key:"_showError",value:function(e,t){t.classList.add(this._inputErrorClass),e.querySelector("#".concat(t.id,"-error")).textContent=t.validationMessage}},{key:"_hideError",value:function(e,t){t.classList.remove(this._inputErrorClass),e.querySelector("#".concat(t.id,"-error")).textContent=""}},{key:"setSubmitButtonState",value:function(){this._button.disabled=!this._form.checkValidity(),this._button.classList.toggle(this._submitButtonErrorClass,!this._form.checkValidity())}}])&&n(t.prototype,o),Object.defineProperty(t,"prototype",{writable:!1}),e}();function r(e,t){for(var n=0;n<t.length;n++){var o=t[n];o.enumerable=o.enumerable||!1,o.configurable=!0,"value"in o&&(o.writable=!0),Object.defineProperty(e,o.key,o)}}var i=function(){function e(t,n){var o=t.renderer;!function(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}(this,e),this._data="",this._renderer=o,this._container=document.querySelector(n),this._id=""}var t,n;return t=e,(n=[{key:"renderItems",value:function(e){var t=this;this._data.reverse().forEach((function(n){t._renderer(n,e)}))}},{key:"addItem",value:function(e){this._container.prepend(e)}},{key:"setData",value:function(e){this._data=e}}])&&r(t.prototype,n),Object.defineProperty(t,"prototype",{writable:!1}),e}();function c(e,t){for(var n=0;n<t.length;n++){var o=t[n];o.enumerable=o.enumerable||!1,o.configurable=!0,"value"in o&&(o.writable=!0),Object.defineProperty(e,o.key,o)}}var s=function(){function e(t){var n=t.nameProfile,o=t.jobProfile,r=t.fotoAvatar;!function(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}(this,e),this.nameProfile=n,this.jobProfile=o,this.fotoAvatar=r,this._id="",this.setUserInfo=this.setUserInfo.bind(this),this.getUserId=this.getUserId.bind(this)}var t,n;return t=e,(n=[{key:"getUserInfo",value:function(){return{name:this.nameProfile.textContent,job:this.jobProfile.textContent}}},{key:"setUserInfo",value:function(e){this.nameProfile.textContent=e.name,this.jobProfile.textContent=e.about,this.fotoAvatar.src=e.avatar,this.identifer=e._id,this.setUserId(e._id)}},{key:"setUserId",value:function(e){this._id=e}},{key:"setAvatarInfo",value:function(e){this.fotoAvatar.src=e}},{key:"getUserId",value:function(){return this.identifer}}])&&c(t.prototype,n),Object.defineProperty(t,"prototype",{writable:!1}),e}(),u={formSelector:".popup__forms",inputSelector:".popup__style",inputErrorClass:"popup__error",submitButtonSelector:".popup__save",submitButtonErrorClass:"popup__button-invalid"},a=(document.querySelector(".popup_profile"),document.querySelector(".popup_confirm"),document.querySelector(".popup_update"),document.querySelector(".popup_foto"),document.querySelector(".popup_open-foto"),document.querySelectorAll(".popup"),"popup_activ"),l=(document.querySelector(".popup__img-open"),document.querySelector(".popup__foto-name"),document.querySelector(".profile__edit-button")),f=document.querySelector(".profile__add-button"),p=document.querySelector(".profile__hover-img"),h=(document.querySelector(".element__close-icon"),document.querySelector(".popup__name")),d=document.querySelector(".popup__work"),y=document.querySelector(".profile__title"),m=document.querySelector(".profile__subtitle"),_=(document.querySelector(".popup__cards"),document.querySelector(".popup__place"),document.querySelector(".popup__about")),v=document.querySelector(".popup__avatar"),b=document.querySelector(".popup__about-foto"),k=(document.querySelector(".elements"),document.querySelector(".profile__foto"));function g(e,t){for(var n=0;n<t.length;n++){var o=t[n];o.enumerable=o.enumerable||!1,o.configurable=!0,"value"in o&&(o.writable=!0),Object.defineProperty(e,o.key,o)}}var w=function(){function e(t){!function(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}(this,e),this.popup=document.querySelector(t),this._handleEscClose=this._handleEscClose.bind(this)}var t,n;return t=e,(n=[{key:"open",value:function(){this.popup.classList.add(a),document.addEventListener("keydown",this._handleEscClose)}},{key:"close",value:function(){this.popup.classList.remove(a),document.removeEventListener("keydown",this._handleEscClose)}},{key:"_handleEscClose",value:function(e){"Escape"===e.key&&this.close()}},{key:"setEventListeners",value:function(){var e=this;this.popup.addEventListener("mousedown",(function(t){(t.target.classList.contains("popup_activ")||t.target.classList.contains("popup__close-icon"))&&e.close()}))}}])&&g(t.prototype,n),Object.defineProperty(t,"prototype",{writable:!1}),e}();function S(e){return S="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(e){return typeof e}:function(e){return e&&"function"==typeof Symbol&&e.constructor===Symbol&&e!==Symbol.prototype?"symbol":typeof e},S(e)}function C(e,t){for(var n=0;n<t.length;n++){var o=t[n];o.enumerable=o.enumerable||!1,o.configurable=!0,"value"in o&&(o.writable=!0),Object.defineProperty(e,o.key,o)}}function L(){return L="undefined"!=typeof Reflect&&Reflect.get?Reflect.get:function(e,t,n){var o=E(e,t);if(o){var r=Object.getOwnPropertyDescriptor(o,t);return r.get?r.get.call(arguments.length<3?e:n):r.value}},L.apply(this,arguments)}function E(e,t){for(;!Object.prototype.hasOwnProperty.call(e,t)&&null!==(e=P(e)););return e}function O(e,t){return O=Object.setPrototypeOf||function(e,t){return e.__proto__=t,e},O(e,t)}function j(e,t){if(t&&("object"===S(t)||"function"==typeof t))return t;if(void 0!==t)throw new TypeError("Derived constructors may only return object or undefined");return function(e){if(void 0===e)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return e}(e)}function P(e){return P=Object.setPrototypeOf?Object.getPrototypeOf:function(e){return e.__proto__||Object.getPrototypeOf(e)},P(e)}var q=function(e){!function(e,t){if("function"!=typeof t&&null!==t)throw new TypeError("Super expression must either be null or a function");e.prototype=Object.create(t&&t.prototype,{constructor:{value:e,writable:!0,configurable:!0}}),Object.defineProperty(e,"prototype",{writable:!1}),t&&O(e,t)}(c,e);var t,n,o,r,i=(o=c,r=function(){if("undefined"==typeof Reflect||!Reflect.construct)return!1;if(Reflect.construct.sham)return!1;if("function"==typeof Proxy)return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],(function(){}))),!0}catch(e){return!1}}(),function(){var e,t=P(o);if(r){var n=P(this).constructor;e=Reflect.construct(t,arguments,n)}else e=t.apply(this,arguments);return j(this,e)});function c(e){var t;return function(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}(this,c),(t=i.call(this,e))._img=t.popup.querySelector(".popup__img-open"),t._text=t.popup.querySelector(".popup__foto-name"),t}return t=c,(n=[{key:"open",value:function(e,t){this._img.src=t,this._img.alt=e,this._text.textContent=e,L(P(c.prototype),"open",this).call(this)}}])&&C(t.prototype,n),Object.defineProperty(t,"prototype",{writable:!1}),c}(w);function I(e){return I="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(e){return typeof e}:function(e){return e&&"function"==typeof Symbol&&e.constructor===Symbol&&e!==Symbol.prototype?"symbol":typeof e},I(e)}function R(e,t){for(var n=0;n<t.length;n++){var o=t[n];o.enumerable=o.enumerable||!1,o.configurable=!0,"value"in o&&(o.writable=!0),Object.defineProperty(e,o.key,o)}}function U(){return U="undefined"!=typeof Reflect&&Reflect.get?Reflect.get:function(e,t,n){var o=T(e,t);if(o){var r=Object.getOwnPropertyDescriptor(o,t);return r.get?r.get.call(arguments.length<3?e:n):r.value}},U.apply(this,arguments)}function T(e,t){for(;!Object.prototype.hasOwnProperty.call(e,t)&&null!==(e=D(e)););return e}function B(e,t){return B=Object.setPrototypeOf||function(e,t){return e.__proto__=t,e},B(e,t)}function x(e,t){if(t&&("object"===I(t)||"function"==typeof t))return t;if(void 0!==t)throw new TypeError("Derived constructors may only return object or undefined");return function(e){if(void 0===e)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return e}(e)}function D(e){return D=Object.setPrototypeOf?Object.getPrototypeOf:function(e){return e.__proto__||Object.getPrototypeOf(e)},D(e)}var A=function(e){!function(e,t){if("function"!=typeof t&&null!==t)throw new TypeError("Super expression must either be null or a function");e.prototype=Object.create(t&&t.prototype,{constructor:{value:e,writable:!0,configurable:!0}}),Object.defineProperty(e,"prototype",{writable:!1}),t&&B(e,t)}(c,e);var t,n,o,r,i=(o=c,r=function(){if("undefined"==typeof Reflect||!Reflect.construct)return!1;if(Reflect.construct.sham)return!1;if("function"==typeof Proxy)return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],(function(){}))),!0}catch(e){return!1}}(),function(){var e,t=D(o);if(r){var n=D(this).constructor;e=Reflect.construct(t,arguments,n)}else e=t.apply(this,arguments);return x(this,e)});function c(e,t){var n;return function(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}(this,c),(n=i.call(this,e))._formSubmit=t,n._form=n.popup.querySelector(".popup__forms"),n._inputList=n.popup.querySelectorAll(".popup__style"),n._btnSaveChange=n.popup.querySelector(".popup__save"),n}return t=c,(n=[{key:"showLoading",value:function(e){this._btnSaveChange.textContent=e?"Сохранение...":"Сохранить"}},{key:"_getInputValues",value:function(){var e=this;return this._formValues={},this._inputList.forEach((function(t){e._formValues[t.name]=t.value})),this._formValues}},{key:"setEventListeners",value:function(){var e=this;U(D(c.prototype),"setEventListeners",this).call(this),this._form.addEventListener("submit",(function(t){t.preventDefault(),e._formSubmit(e._getInputValues())}))}},{key:"close",value:function(){U(D(c.prototype),"close",this).call(this),this._form.reset()}}])&&R(t.prototype,n),Object.defineProperty(t,"prototype",{writable:!1}),c}(w);function V(e){return V="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(e){return typeof e}:function(e){return e&&"function"==typeof Symbol&&e.constructor===Symbol&&e!==Symbol.prototype?"symbol":typeof e},V(e)}function N(e,t){for(var n=0;n<t.length;n++){var o=t[n];o.enumerable=o.enumerable||!1,o.configurable=!0,"value"in o&&(o.writable=!0),Object.defineProperty(e,o.key,o)}}function J(){return J="undefined"!=typeof Reflect&&Reflect.get?Reflect.get:function(e,t,n){var o=F(e,t);if(o){var r=Object.getOwnPropertyDescriptor(o,t);return r.get?r.get.call(arguments.length<3?e:n):r.value}},J.apply(this,arguments)}function F(e,t){for(;!Object.prototype.hasOwnProperty.call(e,t)&&null!==(e=z(e)););return e}function G(e,t){return G=Object.setPrototypeOf||function(e,t){return e.__proto__=t,e},G(e,t)}function H(e,t){if(t&&("object"===V(t)||"function"==typeof t))return t;if(void 0!==t)throw new TypeError("Derived constructors may only return object or undefined");return function(e){if(void 0===e)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return e}(e)}function z(e){return z=Object.setPrototypeOf?Object.getPrototypeOf:function(e){return e.__proto__||Object.getPrototypeOf(e)},z(e)}var M=function(e){!function(e,t){if("function"!=typeof t&&null!==t)throw new TypeError("Super expression must either be null or a function");e.prototype=Object.create(t&&t.prototype,{constructor:{value:e,writable:!0,configurable:!0}}),Object.defineProperty(e,"prototype",{writable:!1}),t&&G(e,t)}(c,e);var t,n,o,r,i=(o=c,r=function(){if("undefined"==typeof Reflect||!Reflect.construct)return!1;if(Reflect.construct.sham)return!1;if("function"==typeof Proxy)return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],(function(){}))),!0}catch(e){return!1}}(),function(){var e,t=z(o);if(r){var n=z(this).constructor;e=Reflect.construct(t,arguments,n)}else e=t.apply(this,arguments);return H(this,e)});function c(e,t){var n;return function(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}(this,c),(n=i.call(this,e))._form=n.popup.querySelector(".popup__forms"),n.handleSubmit=t,n}return t=c,(n=[{key:"setCard",value:function(e){this.card=e}},{key:"getCard",value:function(){return this.card}},{key:"setEventListeners",value:function(){var e=this;J(z(c.prototype),"setEventListeners",this).call(this),this._form.addEventListener("submit",(function(t){t.preventDefault(),e.handleSubmit(e.getCard())}))}}])&&N(t.prototype,n),Object.defineProperty(t,"prototype",{writable:!1}),c}(w);function K(e,t){for(var n=0;n<t.length;n++){var o=t[n];o.enumerable=o.enumerable||!1,o.configurable=!0,"value"in o&&(o.writable=!0),Object.defineProperty(e,o.key,o)}}var Q=function(){function e(t,n){!function(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}(this,e),this.baseUrl=t,this.headers=n}var t,n;return t=e,(n=[{key:"requestResponse",value:function(e){return e.ok?e.json():Promise.reject("Все сломалось:( ".concat(e.status))}},{key:"getInitialCards",value:function(){return fetch("".concat(this.baseUrl,"/cards"),{method:"GET",headers:this.headers}).then(this.requestResponse)}},{key:"addNewCard",value:function(e){return fetch("".concat(this.baseUrl,"/cards"),{method:"POST",headers:this.headers,body:JSON.stringify({name:e.name,link:e.link})}).then(this.requestResponse)}},{key:"getUserInfo",value:function(){return fetch("".concat(this.baseUrl,"/users/me"),{method:"GET",headers:this.headers}).then(this.requestResponse)}},{key:"setUserInfo",value:function(e,t){return fetch("".concat(this.baseUrl,"/users/me"),{method:"PATCH",headers:this.headers,body:JSON.stringify({name:e,about:t})}).then(this.requestResponse)}},{key:"setAvatarInfo",value:function(e){return fetch("".concat(this.baseUrl,"/users/me/avatar"),{method:"PATCH",headers:this.headers,body:JSON.stringify({avatar:e.avatar})}).then(this.requestResponse)}},{key:"deleteCard",value:function(e){return fetch("".concat(this.baseUrl,"/cards/").concat(e),{method:"DELETE",headers:this.headers}).then(this.requestResponse)}},{key:"setLike",value:function(e){return fetch("".concat(this.baseUrl,"/cards/").concat(e,"/likes"),{method:"PUT",headers:this.headers}).then(this.requestResponse)}},{key:"deleteLike",value:function(e){return fetch("".concat(this.baseUrl,"/cards/").concat(e,"/likes"),{method:"DELETE",headers:this.headers}).then(this.requestResponse)}}])&&K(t.prototype,n),Object.defineProperty(t,"prototype",{writable:!1}),e}(),W=new o(u,_),X=new o(u,b),Y=new o(u,v),Z=new q(".popup_open-foto"),$=new Q("https://mesto.nomoreparties.co/v1/cohort-38",{authorization:"1fed1f0c-d99b-4c82-a201-fb2e7265dac6","Content-Type":"application/json",Accept:"application/json: charset=utf-8"}),ee=new s({nameProfile:y,jobProfile:m,fotoAvatar:k}),te=new M(".popup_confirm",(function(e){!function(e){$.deleteCard(e._id).then((function(){e.removeCard(),te.close()})).catch((function(e){console.log("err",e)}))}(e)})),ne=new A(".popup_foto",(function(e){!function(e){var t={name:e.name,link:e.link};ne.showLoading(!0),$.addNewCard(t).then((function(e){ce(e,e.owner._id),ne.close()})).catch((function(e){console.log("err",e)})).finally((function(){ne.showLoading(!1)}))}(e)})),oe=new A(".popup_update",(function(e){var t;t=e,oe.showLoading(!0),$.setAvatarInfo(t).then((function(e){ee.setUserInfo(e),oe.close()})).catch((function(e){console.log("err",e)})).finally((function(){oe.showLoading(!1)}))})),re=new A(".popup_profile",(function(e){!function(e){re.showLoading(!0),$.setUserInfo(e.name,e.job).then((function(e){ee.setUserInfo(e),re.close()})).catch((function(e){console.log("err",e)})).finally((function(){re.showLoading(!1)}))}(e)})),ie=new i({renderer:ce},".elements");function ce(e,n){ie.addItem(function(e){var n={name:e.name,link:e.link,_id:e._id,likes:e.likes,ownerId:e.owner._id,userId:ee.getUserId(),handleCardClick:ae,handleDeleteClick:le,handleLikeClick:se,handleRemoveLike:ue};return new t(n,".card-template").generateCard()}(e))}function se(e,t){$.setLike(e).then((function(e){t(e.likes)})).catch((function(e){console.log("err",e)}))}function ue(e,t){$.deleteLike(e).then((function(e){t(e.likes)})).catch((function(e){console.log("err",e)}))}function ae(e,t){Z.open(e,t)}function le(e){te.setCard(e),te.open()}l.addEventListener("click",(function(){h.value=y.textContent,d.value=m.textContent,re.open(),W.setSubmitButtonState()})),f.addEventListener("click",(function(){ne.open(),X.setSubmitButtonState()})),p.addEventListener("click",(function(){oe.open()})),W.enableValidation(),X.enableValidation(),Y.enableValidation(),re.setEventListeners(),ne.setEventListeners(),Z.setEventListeners(),oe.setEventListeners(),te.setEventListeners(),$.getUserInfo().then((function(e){ee.setUserInfo(e),ee.setUserId(e._id)})).then((function(){$.getInitialCards().then((function(e){ie.setData(e),ie.renderItems(undefined)})).catch((function(e){console.log(e)}))})).catch((function(e){console.log(e)}))})();