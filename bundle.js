(()=>{"use strict";function e(e,t){for(var n=0;n<t.length;n++){var o=t[n];o.enumerable=o.enumerable||!1,o.configurable=!0,"value"in o&&(o.writable=!0),Object.defineProperty(e,o.key,o)}}var t=function(){function t(e,n,o){!function(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}(this,t),this._name=e.name,this._link=e.link,this._id=e._id,this._userId=e.userId,this.ownerId=e.owner.id,this.likes=e.likes,this._handleCardClick=o,this._handleDeleteClick=e.handleDeleteClick,this._handleLikeClick=e.handleLikeClick,this._templateSelector=n}var n,o;return n=t,(o=[{key:"_getTemplate",value:function(){return document.querySelector(this._templateSelector).content.querySelector(".element").cloneNode(!0)}},{key:"_setEventListeners",value:function(){var e=this;this.btnLike=this.element.querySelector(".element__click"),this.btnLike.addEventListener("click",(function(){e._handleLikeClick(e)})),this.btnClose=this.element.querySelector(".element__close-icon"),this.btnClose.addEventListener("click",(function(){e._handleDeleteClick(e)})),this.cardImage=this.element.querySelector(".element__foto"),this.cardImage.addEventListener("click",(function(){e._handleCardClick(e._name,e._link)}))}},{key:"_handleLikeClick",value:function(){this.btnLike.classList.toggle("element__like_activ")}},{key:"deleteImg",value:function(){this.element.remove(),this.element=null}},{key:"generateCard",value:function(){return this.element=this._getTemplate(),this._setEventListeners(),this.cardImage.src=this._link,this.cardImage.alt=this._name,this.element.querySelector(".element__title").textContent=this._name,this.btnLike=this.element.querySelector(".element__click"),this.btnClose=this.element.querySelector(".element__close-icon"),this.resolutionDelete(),this.element}},{key:"resolutionDelete",value:function(){this.ownerId!==this._userId&&(this.btnClose.style.display="none")}},{key:"findLike",value:function(){var e=this;return this.likes.find((function(t){return t===e._userId}))}},{key:"setLikes",value:function(e){this.likes=e,this.element.querySelector(".element__like-container").textContent=this.newLikes.length,this.findLike()?this._btnLike.classList.add("element__like_activ"):this._btnLike.classList.remove("element__like_activ")}}])&&e(n.prototype,o),Object.defineProperty(n,"prototype",{writable:!1}),t}();function n(e,t){for(var n=0;n<t.length;n++){var o=t[n];o.enumerable=o.enumerable||!1,o.configurable=!0,"value"in o&&(o.writable=!0),Object.defineProperty(e,o.key,o)}}var o=function(){function e(t,n){!function(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}(this,e),this._form=n,this._inputSelector=t.inputSelector,this._inputErrorClass=t.inputErrorClass,this._submitButtonSelector=t.submitButtonSelector,this._submitButtonErrorClass=t.submitButtonErrorClass,this._inputs=Array.from(this._form.querySelectorAll(this._inputSelector)),this._button=n.querySelector(this._submitButtonSelector)}var t,o;return t=e,(o=[{key:"enableValidation",value:function(){this._setEventListeners(this._form)}},{key:"_setEventListeners",value:function(e){var t=this;this._inputs.forEach((function(n){return n.addEventListener("input",(function(){t._handleField(e,n),t.setSubmitButtonState(e)}))}))}},{key:"_handleField",value:function(e,t){t.validity.valid?this._hideError(e,t):this._showError(e,t)}},{key:"_showError",value:function(e,t){t.classList.add(this._inputErrorClass),e.querySelector("#".concat(t.id,"-error")).textContent=t.validationMessage}},{key:"_hideError",value:function(e,t){t.classList.remove(this._inputErrorClass),e.querySelector("#".concat(t.id,"-error")).textContent=""}},{key:"setSubmitButtonState",value:function(){this._button.disabled=!this._form.checkValidity(),this._button.classList.toggle(this._submitButtonErrorClass,!this._form.checkValidity())}}])&&n(t.prototype,o),Object.defineProperty(t,"prototype",{writable:!1}),e}();function r(e,t){for(var n=0;n<t.length;n++){var o=t[n];o.enumerable=o.enumerable||!1,o.configurable=!0,"value"in o&&(o.writable=!0),Object.defineProperty(e,o.key,o)}}var i=function(){function e(t,n){var o=t.renderer;!function(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}(this,e),this._data="",this._renderer=o,this._container=document.querySelector(n),this._id=""}var t,n;return t=e,(n=[{key:"renderItems",value:function(e){var t=this;this._data.forEach((function(n){t._renderer(n,e)}))}},{key:"addItem",value:function(e){this._container.append(e)}},{key:"setData",value:function(e){this._data=e}}])&&r(t.prototype,n),Object.defineProperty(t,"prototype",{writable:!1}),e}();function c(e,t){for(var n=0;n<t.length;n++){var o=t[n];o.enumerable=o.enumerable||!1,o.configurable=!0,"value"in o&&(o.writable=!0),Object.defineProperty(e,o.key,o)}}var u=function(){function e(t){var n=t.nameProfile,o=t.jobProfile,r=t.fotoAvatar;!function(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}(this,e),this.nameProfile=n,this.jobProfile=o,this.fotoAvatar=r,this._id="",this.setUserInfo=this.setUserInfo.bind(this),this.getUserId=this.getUserId.bind(this)}var t,n;return t=e,(n=[{key:"getUserInfo",value:function(){return{name:this.nameProfile.textContent,job:this.jobProfile.textContent}}},{key:"setUserInfo",value:function(e){this.nameProfile.textContent=e.name,this.jobProfile.textContent=e.about,this.fotoAvatar.src=e.avatar,this.identifer=e._id,this.setUserId(e._id)}},{key:"setUserId",value:function(e){this._id=e}},{key:"setAvatarInfo",value:function(e){this.fotoAvatar.src=e}},{key:"getUserId",value:function(){return this.identifer}}])&&c(t.prototype,n),Object.defineProperty(t,"prototype",{writable:!1}),e}(),s={formSelector:".popup__forms",inputSelector:".popup__style",inputErrorClass:"popup__error",submitButtonSelector:".popup__save",submitButtonErrorClass:"popup__button-invalid"},a=(document.querySelector(".popup_profile"),document.querySelector(".popup_confirm"),document.querySelector(".popup_update"),document.querySelector(".popup_foto"),document.querySelector(".popup_open-foto"),document.querySelectorAll(".popup"),"popup_activ"),l=(document.querySelector(".popup__img-open"),document.querySelector(".popup__foto-name"),document.querySelector(".profile__edit-button")),f=document.querySelector(".profile__add-button"),p=document.querySelector(".profile__hover-img"),h=(document.querySelector(".element__close-icon"),document.querySelector(".popup__name"),document.querySelector(".popup__work"),document.querySelector(".profile__title")),d=document.querySelector(".profile__subtitle"),y=(document.querySelector(".popup__cards"),document.querySelector(".popup__place"),document.querySelector(".popup__about")),_=document.querySelector(".popup__about-foto"),m=(document.querySelector(".elements"),document.querySelector(".profile__foto"));function b(e,t){for(var n=0;n<t.length;n++){var o=t[n];o.enumerable=o.enumerable||!1,o.configurable=!0,"value"in o&&(o.writable=!0),Object.defineProperty(e,o.key,o)}}var v=function(){function e(t){!function(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}(this,e),this.popup=document.querySelector(t),this._handleEscClose=this._handleEscClose.bind(this)}var t,n;return t=e,(n=[{key:"open",value:function(){this.popup.classList.add(a),document.addEventListener("keydown",this._handleEscClose)}},{key:"close",value:function(){this.popup.classList.remove(a),document.removeEventListener("keydown",this._handleEscClose)}},{key:"_handleEscClose",value:function(e){"Escape"===e.key&&this.close()}},{key:"setEventListeners",value:function(){var e=this;this.popup.addEventListener("mousedown",(function(t){(t.target.classList.contains("popup_activ")||t.target.classList.contains("popup__close-icon"))&&e.close()}))}}])&&b(t.prototype,n),Object.defineProperty(t,"prototype",{writable:!1}),e}();function k(e){return k="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(e){return typeof e}:function(e){return e&&"function"==typeof Symbol&&e.constructor===Symbol&&e!==Symbol.prototype?"symbol":typeof e},k(e)}function g(e,t){for(var n=0;n<t.length;n++){var o=t[n];o.enumerable=o.enumerable||!1,o.configurable=!0,"value"in o&&(o.writable=!0),Object.defineProperty(e,o.key,o)}}function w(){return w="undefined"!=typeof Reflect&&Reflect.get?Reflect.get:function(e,t,n){var o=S(e,t);if(o){var r=Object.getOwnPropertyDescriptor(o,t);return r.get?r.get.call(arguments.length<3?e:n):r.value}},w.apply(this,arguments)}function S(e,t){for(;!Object.prototype.hasOwnProperty.call(e,t)&&null!==(e=L(e)););return e}function E(e,t){return E=Object.setPrototypeOf||function(e,t){return e.__proto__=t,e},E(e,t)}function C(e,t){if(t&&("object"===k(t)||"function"==typeof t))return t;if(void 0!==t)throw new TypeError("Derived constructors may only return object or undefined");return function(e){if(void 0===e)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return e}(e)}function L(e){return L=Object.setPrototypeOf?Object.getPrototypeOf:function(e){return e.__proto__||Object.getPrototypeOf(e)},L(e)}var O=function(e){!function(e,t){if("function"!=typeof t&&null!==t)throw new TypeError("Super expression must either be null or a function");e.prototype=Object.create(t&&t.prototype,{constructor:{value:e,writable:!0,configurable:!0}}),Object.defineProperty(e,"prototype",{writable:!1}),t&&E(e,t)}(c,e);var t,n,o,r,i=(o=c,r=function(){if("undefined"==typeof Reflect||!Reflect.construct)return!1;if(Reflect.construct.sham)return!1;if("function"==typeof Proxy)return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],(function(){}))),!0}catch(e){return!1}}(),function(){var e,t=L(o);if(r){var n=L(this).constructor;e=Reflect.construct(t,arguments,n)}else e=t.apply(this,arguments);return C(this,e)});function c(e){var t;return function(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}(this,c),(t=i.call(this,e))._img=t.popup.querySelector(".popup__img-open"),t._text=t.popup.querySelector(".popup__foto-name"),t}return t=c,(n=[{key:"open",value:function(e,t){this._img.src=t,this._img.alt=e,this._text.textContent=e,w(L(c.prototype),"open",this).call(this)}}])&&g(t.prototype,n),Object.defineProperty(t,"prototype",{writable:!1}),c}(v);function j(e){return j="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(e){return typeof e}:function(e){return e&&"function"==typeof Symbol&&e.constructor===Symbol&&e!==Symbol.prototype?"symbol":typeof e},j(e)}function P(e,t){for(var n=0;n<t.length;n++){var o=t[n];o.enumerable=o.enumerable||!1,o.configurable=!0,"value"in o&&(o.writable=!0),Object.defineProperty(e,o.key,o)}}function q(){return q="undefined"!=typeof Reflect&&Reflect.get?Reflect.get:function(e,t,n){var o=I(e,t);if(o){var r=Object.getOwnPropertyDescriptor(o,t);return r.get?r.get.call(arguments.length<3?e:n):r.value}},q.apply(this,arguments)}function I(e,t){for(;!Object.prototype.hasOwnProperty.call(e,t)&&null!==(e=T(e)););return e}function R(e,t){return R=Object.setPrototypeOf||function(e,t){return e.__proto__=t,e},R(e,t)}function U(e,t){if(t&&("object"===j(t)||"function"==typeof t))return t;if(void 0!==t)throw new TypeError("Derived constructors may only return object or undefined");return function(e){if(void 0===e)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return e}(e)}function T(e){return T=Object.setPrototypeOf?Object.getPrototypeOf:function(e){return e.__proto__||Object.getPrototypeOf(e)},T(e)}var x=function(e){!function(e,t){if("function"!=typeof t&&null!==t)throw new TypeError("Super expression must either be null or a function");e.prototype=Object.create(t&&t.prototype,{constructor:{value:e,writable:!0,configurable:!0}}),Object.defineProperty(e,"prototype",{writable:!1}),t&&R(e,t)}(c,e);var t,n,o,r,i=(o=c,r=function(){if("undefined"==typeof Reflect||!Reflect.construct)return!1;if(Reflect.construct.sham)return!1;if("function"==typeof Proxy)return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],(function(){}))),!0}catch(e){return!1}}(),function(){var e,t=T(o);if(r){var n=T(this).constructor;e=Reflect.construct(t,arguments,n)}else e=t.apply(this,arguments);return U(this,e)});function c(e,t){var n;return function(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}(this,c),(n=i.call(this,e))._formSubmit=t,n._form=n.popup.querySelector(".popup__forms"),n._inputList=n.popup.querySelectorAll(".popup__style"),n._btnSaveChange=n.popup.querySelector(".popup__save"),n}return t=c,(n=[{key:"showLoading",value:function(e){this._btnSaveChange.textContent=e?"Сохранение...":"Сохранить"}},{key:"_getInputValues",value:function(){var e=this;return this._formValues={},this._inputList.forEach((function(t){e._formValues[t.name]=t.value})),this._formValues}},{key:"setEventListeners",value:function(){var e=this;q(T(c.prototype),"setEventListeners",this).call(this),this._form.addEventListener("submit",(function(t){t.preventDefault(),e._formSubmit(e._getInputValues())}))}},{key:"close",value:function(){q(T(c.prototype),"close",this).call(this),this._form.reset()}}])&&P(t.prototype,n),Object.defineProperty(t,"prototype",{writable:!1}),c}(v);function B(e){return B="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(e){return typeof e}:function(e){return e&&"function"==typeof Symbol&&e.constructor===Symbol&&e!==Symbol.prototype?"symbol":typeof e},B(e)}function D(e,t){for(var n=0;n<t.length;n++){var o=t[n];o.enumerable=o.enumerable||!1,o.configurable=!0,"value"in o&&(o.writable=!0),Object.defineProperty(e,o.key,o)}}function A(){return A="undefined"!=typeof Reflect&&Reflect.get?Reflect.get:function(e,t,n){var o=V(e,t);if(o){var r=Object.getOwnPropertyDescriptor(o,t);return r.get?r.get.call(arguments.length<3?e:n):r.value}},A.apply(this,arguments)}function V(e,t){for(;!Object.prototype.hasOwnProperty.call(e,t)&&null!==(e=F(e)););return e}function N(e,t){return N=Object.setPrototypeOf||function(e,t){return e.__proto__=t,e},N(e,t)}function J(e,t){if(t&&("object"===B(t)||"function"==typeof t))return t;if(void 0!==t)throw new TypeError("Derived constructors may only return object or undefined");return function(e){if(void 0===e)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return e}(e)}function F(e){return F=Object.setPrototypeOf?Object.getPrototypeOf:function(e){return e.__proto__||Object.getPrototypeOf(e)},F(e)}var G=function(e){!function(e,t){if("function"!=typeof t&&null!==t)throw new TypeError("Super expression must either be null or a function");e.prototype=Object.create(t&&t.prototype,{constructor:{value:e,writable:!0,configurable:!0}}),Object.defineProperty(e,"prototype",{writable:!1}),t&&N(e,t)}(c,e);var t,n,o,r,i=(o=c,r=function(){if("undefined"==typeof Reflect||!Reflect.construct)return!1;if(Reflect.construct.sham)return!1;if("function"==typeof Proxy)return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],(function(){}))),!0}catch(e){return!1}}(),function(){var e,t=F(o);if(r){var n=F(this).constructor;e=Reflect.construct(t,arguments,n)}else e=t.apply(this,arguments);return J(this,e)});function c(e,t){var n;return function(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}(this,c),(n=i.call(this,e))._form=n.popup.querySelector(".popup__forms"),n.handleSubmit=t,n}return t=c,(n=[{key:"setCard",value:function(e){this.card=e}},{key:"getCard",value:function(){return this.card}},{key:"setEventListeners",value:function(){var e=this;A(F(c.prototype),"setEventListeners",this).call(this),this._form.addEventListener("submit",(function(t){t.preventDefault(),e.handleSubmit(e.getCard())}))}}])&&D(t.prototype,n),Object.defineProperty(t,"prototype",{writable:!1}),c}(v);function H(e,t){for(var n=0;n<t.length;n++){var o=t[n];o.enumerable=o.enumerable||!1,o.configurable=!0,"value"in o&&(o.writable=!0),Object.defineProperty(e,o.key,o)}}var z=function(){function e(t,n){!function(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}(this,e),this.baseUrl=t,this.headers=n}var t,n;return t=e,(n=[{key:"requestResponse",value:function(e){return e.ok?e.json():Promise.reject("Все сломалось:( ".concat(e.status))}},{key:"getInitialCards",value:function(){return fetch("".concat(this.baseUrl,"/cards"),{method:"GET",headers:this.headers}).then(this.requestResponse)}},{key:"addNewCard",value:function(e){return fetch("".concat(this.baseUrl,"/cards"),{method:"POST",headers:this.headers,body:JSON.stringify({name:e.name,link:e.link})}).then(this.requestResponse)}},{key:"getUserInfo",value:function(){return fetch("".concat(this.baseUrl,"/users/me"),{method:"GET",headers:this.headers}).then(this.requestResponse)}},{key:"setUserInfo",value:function(e,t){return fetch("".concat(this.baseUrl,"/users/me"),{method:"PATCH",headers:this.headers,body:JSON.stringify({name:e,about:t})}).then(this.requestResponse)}},{key:"setAvatarInfo",value:function(e){return fetch("".concat(this.baseUrl,"/users/me/avatar"),{method:"PATCH",headers:this.headers,body:JSON.stringify({avatar:e.avatar})}).then(this.requestResponse)}},{key:"deleteCard",value:function(e){return fetch("".concat(this.baseUrl,"/cards/").concat(e),{method:"DELETE",headers:this.headers}).then(this.requestResponse)}},{key:"getLike",value:function(e){return fetch("".concat(this.baseUrl,"/cards/").concat(e,"/likes"),{method:"PUT",headers:this.headers}).then(this.requestResponse)}},{key:"deleteLike",value:function(e){return fetch("".concat(this.baseUrl,"/cards/").concat(e,"/likes"),{method:"DELETE",headers:this.headers}).then(this.requestResponse)}}])&&H(t.prototype,n),Object.defineProperty(t,"prototype",{writable:!1}),e}(),M=new o(s,y),K=new o(s,_),Q=new O(".popup_open-foto"),W=new z("https://mesto.nomoreparties.co/v1/cohort-38",{authorization:"1fed1f0c-d99b-4c82-a201-fb2e7265dac6","Content-Type":"application/json",Accept:"application/json: charset=utf-8"}),X=new u({nameProfile:h,jobProfile:d,fotoAvatar:m}),Y=new G(".popup_confirm",(function(e){!function(e){W.deleteCard(e._id).then((function(){e.deleteImg(),Y.close()})).catch((function(e){console.log("err",e)}))}(e)})),Z=new x(".popup_foto",(function(e){!function(e){var t={name:e.name,link:e.link};Z.showLoading(!0),W.addNewCard(t).then((function(){ne(t),Z.close()})).catch((function(e){console.log("err",e)})).finally((function(){Z.showLoading(!1)}))}(e)})),$=new x(".popup_update",(function(e){var t;t=e,$.showLoading(!0),W.setAvatarInfo(t).then((function(e){X.setUserInfo(e),$.close()})).catch((function(e){console.log("err",e)})).finally((function(){$.showLoading(!1)}))})),ee=new x(".popup_profile",(function(e){!function(e){ee.showLoading(!0),W.setUserInfo(e.name,e.job).then((function(e){X.setUserInfo(e),ee.close()})).catch((function(e){console.log("err",e)})).finally((function(){ee.showLoading(!1)}))}(e)})),te=new i({renderer:ne},".elements");function ne(e,n){te.addItem(function(e,n){var o={name:e.name,link:e.link,_id:e._id,likes:e.likes,owner:e.owner,userId:n,handleCardClick:Q,handleDeleteClick:ie,handleLikeClick:oe};return new t(o,".card-template",re).generateCard()}(e,n))}function oe(e){W.getLike(e._id).then((function(){e.findLike(),e.setLikes()})).catch((function(e){console.log("err",e)}))}function re(e,t){Q.open(e,t)}function ie(e){Y.setCard(e),Y.open()}l.addEventListener("click",(function(){ee.open(),M.setSubmitButtonState()})),f.addEventListener("click",(function(){Z.open(),K.setSubmitButtonState()})),p.addEventListener("click",(function(){$.open()})),M.enableValidation(),K.enableValidation(),ee.setEventListeners(),Z.setEventListeners(),Q.setEventListeners(),$.setEventListeners(),Y.setEventListeners(),W.getUserInfo().then((function(e){X.setUserInfo(e),X.setUserId(e._id)})).then((function(){var e;e=X.getUserId(),W.getInitialCards().then((function(t){te.setData(t),te.renderItems(e)})).catch((function(e){console.log(e)}))})).catch((function(e){console.log(e)}))})();